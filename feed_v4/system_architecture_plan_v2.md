# üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã ‚Äî –≤–µ—Ä—Å–∏—è 2 (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)

---

## üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –≤—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–æ—á–Ω—ã—Ö —Å–≤–µ—á–µ–π (OHLCV) –∏ —Ä–∞—Å—á—ë—Ç–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.  
–ö–ª—é—á–µ–≤—ã–µ —Ü–µ–ª–∏: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º–æ—Å—Ç—å, –Ω–∞–¥—ë–∂–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å.

---

## ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- Redis = runtime-—à–∏–Ω–∞ –∏ –∫–µ—à
- PostgreSQL = –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤: M1, M5, M15

---

## üóÇÔ∏è –°–æ—Å—Ç–∞–≤ —Å–∏—Å—Ç–µ–º—ã (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ .py —Ñ–∞–π–ª–æ–≤)

| –§–∞–π–ª                   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                           |
|------------------------|----------------------------------------------------------------------|
| `feed_v4_main.py`      | –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Redis/PG, –∑–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤. |
| `infra.py`             | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Redis/PG, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç–ª–∞–¥–∫–∞, `run_safe_loop()`        |
| `core_io.py`           | –§—É–Ω–∫—Ü–∏–∏ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö OHLCV, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, Stream —Å–æ–±—ã—Ç–∏–π     |
| `feed_and_aggregate.py`| –ü–æ–ª—É—á–µ–Ω–∏–µ M1, –∞–≥—Ä–µ–≥–∞—Ü–∏—è M5/M15, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis –∏ PG, markPrice     |
| `indicators_main.py`   | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∞–≥–≥—Ä–µ–≥–∞—Ü–∏–∏, —Ä–∞—Å—á—ë—Ç –∏ –∑–∞–ø–∏—Å—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤                    |
| `restore_redis_from_pg.py` | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ Redis –∏–∑ PostgreSQL –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ                       |

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

1. WebSocket ‚Üí `feed_and_aggregate.py`
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è M1 –≤ Redis TS + PG
3. –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –≤ `ohlcv_m1_ready`
4. –í–Ω—É—Ç—Ä–∏ –∂–µ –º–æ–¥—É–ª—è:
   - –ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è M5/M15
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Redis TS + PG
   - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è `ohlcv_<tf>_ready`
5. `indicators_main.py` –ø–æ Stream:
   - –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–µ—á–∏ ‚Üí —Å—á–∏—Ç–∞–µ—Ç ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

## üß† Redis: —Ä–æ–ª—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ        | –¢–∏–ø          | –ö–ª—é—á                            |
|-------------------|--------------|----------------------------------|
| –°–≤–µ—á–∏             | TimeSeries   | `ohlcv:<symbol>:<tf>`           |
| markPrice         | String       | `price:<symbol>`                |
| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã        | Hash         | `indicator:<symbol>:<tf>`       |
| –°–æ–±—ã—Ç–∏—è —Å–≤–µ—á–µ–π    | Stream       | `ohlcv_m1_ready`, `ohlcv_m5_ready` |
| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≥–æ—Ç–æ–≤–æ | Stream       | `indicators_ready_stream`       |

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è Consumer Groups –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞.

---

## üóÑÔ∏è PostgreSQL: —Ä–æ–ª–∏ –∏ —Ç–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞                    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                     |
|----------------------------|------------------------------------------------|
| `ohlcv4_m1`, `_m5`, `_m15` | –°–≤–µ—á–∏ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π                             |
| `indicator_values_v4`      | –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤              |
| `indicator_instances_v4`   | –ê–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤                   |
| `indicator_parameters_v4`  | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–∂–¥–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞                      |
| `missing_m1_log_v4`        | –ñ—É—Ä–Ω–∞–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö M1 —Å–≤–µ—á–µ–π                |
| `system_log_v4`            | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ª–æ–≥ –æ—à–∏–±–æ–∫ –∏ —Å–æ–±—ã—Ç–∏–π               |

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã: `PRIMARY KEY`, `UNIQUE`, `INDEX`.

---

## üîÅ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ Redis

- –ú–æ–¥—É–ª—å `restore_redis_from_pg.py` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 250 —Å–≤–µ—á–µ–π –Ω–∞ —Ç–∏–∫–µ—Ä/—Ç–∞–π–º—Ñ—Ä–µ–π–º
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

---

## üß© –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

- –í—Å–µ –≤–æ—Ä–∫–µ—Ä—ã –∑–∞—â–∏—â–µ–Ω—ã —á–µ—Ä–µ–∑ `run_safe_loop`
- Redis –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–±—Ä–æ—à–µ–Ω: –≤—Å—ë –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ PG
- –ü–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `ON CONFLICT DO UPDATE`
- –õ–æ–≥ –æ—à–∏–±–æ–∫ –≤–µ–¥—ë—Ç—Å—è –≤ PostgreSQL (`system_log_v4`)

---

## üß∞ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç    | –ú–µ—Ç–æ–¥                                               |
|--------------|------------------------------------------------------|
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥   | —á–µ—Ä–µ–∑ `system_log_v4` –∏ RedisInsight                 |
| –ú–µ—Ç—Ä–∏–∫–∏      | —á–µ—Ä–µ–∑ Redis Streams `XPENDING` + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ |
| –û—à–∏–±–∫–∏       | —á–µ—Ä–µ–∑ Telegram-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)              |
| CI/CD        | –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ (Render-compatible)  |

---

## üö¶ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –¢–æ–ª—å–∫–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã: M1, M5, M15
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –≤ —Ä–∞–º–∫–∞—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- –ù–µ—Ç `snapshot.py` ‚Äî –≤—Å—ë –ø–∏—à–µ—Ç—Å—è –≤ PG —Å—Ä–∞–∑—É
- `markPrice` –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ‚Äî –ø—Ä–∏—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ WebSocket

---

## ‚úÖ –í—ã–≤–æ–¥

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞:
- —á—ë—Ç–∫–æ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö —Ä–æ–ª—è—Ö Redis –∏ PostgreSQL;
- –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö;
- –ø–æ–ª–Ω–æ–π –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ —Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏;
- –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–µ–∞–∫—Ü–∏–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö.

–ì–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–º—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –Ω–∞ Render + RedisCloud + PostgreSQL.

---