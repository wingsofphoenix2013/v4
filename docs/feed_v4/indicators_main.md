# üìÇ `indicators_main.py` ‚Äî —Ä–∞—Å—á—ë—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø–æ –≥–æ—Ç–æ–≤—ã–º —Å–≤–µ—á–∞–º

---

## üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`indicators_main.py` ‚Äî –≤–æ—Ä–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:

- –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Redis Stream `ohlcv_<tf>_ready`,
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤–µ—á–∏ –∏–∑ RedisTimeSeries –ø–æ —Å–∏–º–≤–æ–ª—É –∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º—É,
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (EMA, RSI, ATR, ...),
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Redis –∏ PostgreSQL,
- –ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Ä–∞—Å—á—ë—Ç–µ –≤ Redis Stream `indicators_ready_stream`.

---

## üß± –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. üîî –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Redis Streams

- `XREAD` –∏–∑ –∫–∞–Ω–∞–ª–æ–≤ `ohlcv_m5_ready`, `ohlcv_m15_ready` –∏ –¥—Ä.
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:
  ```json
  {
    "symbol": "BTCUSDT",
    "interval": "m5",
    "open_time": "2025-05-16T10:40:00"
  }
  ```

---

### 2. üì• –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ—á–µ–π –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞

- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–≤–µ—á–µ–π –ø–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º—É –∏ —Ç–∏–∫–µ—Ä—É
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è RedisTimeSeries —á–µ—Ä–µ–∑ `TS.RANGE` –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ `core_io.py`

---

### 3. üß† –í—ã–±–æ—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ:
  - –ù–∞–ø—Ä–∏–º–µ—Ä, `EMA(9)`, `RSI(14)`, `ATR(14)`
- –ú–æ–≥—É—Ç –±—ã—Ç—å:
  - –∑–∞–¥–∞–Ω—ã –∂—ë—Å—Ç–∫–æ –≤ —Å–ª–æ–≤–∞—Ä–µ,
  - –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ Redis (`indicator_config:<symbol>:<tf>`)

---

### 4. üßÆ –†–∞—Å—á—ë—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

- –ö–∞–∂–¥—ã–π —Ç–∏–ø –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å:
  ```python
  await process_ema(...)
  await process_rsi(...)
  await process_atr(...)
  ```
- –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç:
  - `symbol`, `tf`, `open_time`
  - `candles` (DataFrame)
  - `params`, `precision_price`
  - `redis`, `pg_pool`, `stream_publish`

---

### 5. üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

- Redis:
  - `HSET indicator:<symbol>:<tf> param_name ‚Üí value`
- PostgreSQL:
  - `INSERT INTO indicator_values_v2 (...)`
- Redis Stream:
  - `XADD indicators_ready_stream * {...}`

---

## üß© –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- `core_io.py` ‚Äî –¥–ª—è I/O
- `infra.py` ‚Äî Redis, PG, –ª–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞
- `ema.py`, `rsi.py`, `atr.py`, ... ‚Äî –ª–æ–≥–∏–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

---

## üîÅ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤

- –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º `ohlcv_<tf>_ready`: M5, M15, M30, H1 –∏ —Ç.–¥.
- –ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üîê –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

- –û–±—ë—Ä—Ç–∫–∞ —á–µ—Ä–µ–∑ `run_safe_loop(...)`
- –ö–∞–∂–¥—ã–π —Ä–∞—Å—á—ë—Ç ‚Äî –≤–Ω—É—Ç—Ä–∏ `try/except`
- –û—à–∏–±–∫–∞ –≤ –æ–¥–Ω–æ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–µ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ

---

## üìé –†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ

| –§—É–Ω–∫—Ü–∏—è                | –î–∞ |
|------------------------|----|
| –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è    | ‚úÖ |
| –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ—á–µ–π        | ‚úÖ |
| –†–∞—Å—á—ë—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤     | ‚úÖ |
| –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞  | ‚úÖ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤   | ‚úÖ |

---