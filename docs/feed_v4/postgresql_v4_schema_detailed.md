# üóÑÔ∏è PostgreSQL (v4) ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

---

## üìã –¢–∞–±–ª–∏—Ü–∞ `ohlcv4_m1`

–•—Ä–∞–Ω–∏—Ç –ø–æ—Å—Ç—É–ø–∞—é—â–∏–µ —Å –±–∏—Ä–∂–∏ M1-—Å–≤–µ—á–∏. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —É—Å—Ç—Ä–æ–µ–Ω—ã `ohlcv4_m5` –∏ `ohlcv4_m15`.

---

### üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ü–æ–ª–µ        | –¢–∏–ø         | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                         |
|-------------|--------------|--------------|----------------------------------|
| `symbol`    | TEXT         | ‚úÖ            | –¢–∏–∫–µ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä `BTCUSDT`        |
| `open_time` | TIMESTAMP    | ‚úÖ            | –í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–≤–µ—á–∏             |
| `open`      | NUMERIC      | ‚úÖ            | –¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è                    |
| `high`      | NUMERIC      | ‚úÖ            | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞                |
| `low`       | NUMERIC      | ‚úÖ            | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞                 |
| `close`     | NUMERIC      | ‚úÖ            | –¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è                    |
| `volume`    | NUMERIC      | ‚úÖ            | –û–±—ä—ë–º                            |
| `source`    | TEXT         | ‚ùå (default)  | –ò—Å—Ç–æ—á–Ω–∏–∫: `stream`, `api`, ...   |
| `inserted_at` | TIMESTAMP  | ‚ùå (default)  | –í—Ä–µ–º—è –≤—Å—Ç–∞–≤–∫–∏ –∑–∞–ø–∏—Å–∏             |

---

### üîê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- `PRIMARY KEY (symbol, open_time)`

---

### üóÇ –ò–Ω–¥–µ–∫—Å—ã

- `(symbol, open_time)` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á

---

## üìã –¢–∞–±–ª–∏—Ü–∞ `missing_m1_log_v4`

–•—Ä–∞–Ω–∏—Ç –∑–∞–ø–∏—Å–∏ –æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–≤–µ—á–∞—Ö M1 –∏ —Å—Ç–∞—Ç—É—Å –∏—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

---

### üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ü–æ–ª–µ         | –¢–∏–ø       | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                |
|--------------|-----------|--------------|-----------------------------------------|
| `symbol`     | TEXT      | ‚úÖ            | –¢–∏–∫–µ—Ä                                   |
| `open_time`  | TIMESTAMP | ‚úÖ            | –í—Ä–µ–º—è —Å–≤–µ—á–∏, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ —Ö–≤–∞—Ç–∞–ª–æ         |
| `detected_at`| TIMESTAMP | ‚ùå (default)  | –ö–æ–≥–¥–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –ø—Ä–æ–ø—É—Å–∫                 |
| `fixed`      | BOOLEAN   | ‚ùå (default)  | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–∏ —Å–≤–µ—á–∞                  |
| `fixed_at`   | TIMESTAMP | ‚ùå           | –ö–æ–≥–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞                     |

---

### üîê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- `PRIMARY KEY (symbol, open_time)`

---

## üìã –¢–∞–±–ª–∏—Ü–∞ `indicator_instances_v4`

–û–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞—Å—á—ë—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–º —Ç–∏–∫–µ—Ä–µ –∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º–µ.

---

### üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ü–æ–ª–µ             | –¢–∏–ø       | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                        |
|------------------|-----------|--------------|-------------------------------------------------|
| `id`             | SERIAL    | ‚úÖ            | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ä–∞—Å—á—ë—Ç–∞                          |
| `indicator`      | TEXT      | ‚úÖ            | –¢–∏–ø: `ema`, `rsi`, `atr`, ...                   |
| `symbol`         | TEXT      | ‚úÖ            | –¢–∏–∫–µ—Ä                                           |
| `timeframe`      | TEXT      | ‚úÖ            | –¢–∞–π–º—Ñ—Ä–µ–π–º (`m5`, `m15`)                         |
| `enabled`        | BOOLEAN   | ‚ùå (default)  | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ä–∞—Å—á—ë—Ç                              |
| `stream_publish` | BOOLEAN   | ‚ùå (default)  | –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Redis Stream        |
| `created_at`     | TIMESTAMP | ‚ùå (default)  | –ö–æ–≥–¥–∞ –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—á—ë—Ç                      |

---

### üîê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- `PRIMARY KEY (id)`

---

## üìã –¢–∞–±–ª–∏—Ü–∞ `indicator_parameters_v4`

–•—Ä–∞–Ω–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ `indicator_instances_v4`.

---

### üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ü–æ–ª–µ         | –¢–∏–ø     | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
|--------------|---------|--------------|-------------------------------------------|
| `id`         | SERIAL  | ‚úÖ            | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–∞        |
| `instance_id`| INTEGER | ‚úÖ            | –°—Å—ã–ª–∫–∞ –Ω–∞ `indicator_instances_v4(id)`    |
| `param`      | TEXT    | ‚úÖ            | –ò–º—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (`length`, `angle_up`, ...) |
| `value`      | TEXT    | ‚úÖ            | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (–≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏)        |

---

### üîê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- `UNIQUE(instance_id, param)`
- `FOREIGN KEY (instance_id)` ‚Üí `indicator_instances_v4(id)` ON DELETE CASCADE

---

## üìã –¢–∞–±–ª–∏—Ü–∞ `indicator_values_v4`

–•—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø–æ –∫–∞–∂–¥–æ–º—É `symbol`, `open_time`, `param_name`.

---

### üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ü–æ–ª–µ         | –¢–∏–ø              | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                          |
|--------------|------------------|--------------|---------------------------------------------------|
| `id`         | SERIAL           | ‚úÖ            | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID                                      |
| `instance_id`| INTEGER          | ‚úÖ            | –°—Å—ã–ª–∫–∞ –Ω–∞ `indicator_instances_v4(id)`            |
| `symbol`     | TEXT             | ‚úÖ            | –¢–∏–∫–µ—Ä                                              |
| `open_time`  | TIMESTAMP        | ‚úÖ            | –ú–µ—Ç–∫–∞ –Ω–∞—á–∞–ª–∞ —Å–≤–µ—á–∏                                |
| `param_name` | TEXT             | ‚úÖ            | –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (`value`, `trend`, ...)        |
| `value`      | DOUBLE PRECISION | ‚úÖ            | –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ                              |
| `updated_at` | TIMESTAMP        | ‚ùå (default)  | –ú–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏                   |

---

### üîê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- `UNIQUE(instance_id, symbol, open_time, param_name)`
- `FOREIGN KEY (instance_id)` ‚Üí `indicator_instances_v4(id)` ON DELETE CASCADE

---

### üóÇ –ò–Ω–¥–µ–∫—Å—ã

| –ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞          | –ü–æ–ª—è                         |
|---------------------------|------------------------------|
| `idx_iv4_symbol_time`     | `(symbol, open_time)`        |
| `idx_iv4_instance_id`     | `(instance_id)`              |
| `idx_iv4_param_name`      | `(param_name)`               |

---

## üìã –¢–∞–±–ª–∏—Ü–∞ `system_log_v4`

–õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –∏–Ω—Ñ–æ—Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã.

---

### üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞

| –ü–æ–ª–µ       | –¢–∏–ø       | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                             |
|------------|-----------|--------------|--------------------------------------|
| `id`       | SERIAL    | ‚úÖ            | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID                        |
| `timestamp`| TIMESTAMP | ‚ùå (default)  | –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏                         |
| `module`   | TEXT      | ‚úÖ            | –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è (`AGGREGATOR`, ...)  |
| `level`    | TEXT      | ‚úÖ            | –£—Ä–æ–≤–µ–Ω—å (`INFO`, `ERROR`, ...)       |
| `message`  | TEXT      | ‚úÖ            | –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç                       |
| `details`  | JSONB     | ‚ùå           | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è / stacktrace     |

---

### üîê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- `PRIMARY KEY (id)`

---

## ‚úÖ –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–∏—à—É—Ç—Å—è –≤ PostgreSQL –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –∏–ª–∏ —Ä–∞—Å—á—ë—Ç–µ
- –ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (`snapshot.py` ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- Redis —Å–ª—É–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∫–∞–∫ runtime –∏ –∫–µ—à
- PostgreSQL = –∞—Ä—Ö–∏–≤, –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã

---