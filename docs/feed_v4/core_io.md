# üîÑ `core_io.py` ‚Äî –º–æ–¥—É–ª—å –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–≥–æ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞

`core_io.py` —Ä–µ–∞–ª–∏–∑—É–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ª–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Redis –∏ PostgreSQL. –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø—Ä–∏–∫–ª–∞–¥–Ω—É—é –∑–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ —Å–≤–µ—á–µ–π, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –≤ —Ä–∞–º–∫–∞—Ö —Ç–æ—Ä–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.

---

## üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –≤—Å—é –ª–æ–≥–∏–∫—É –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –†–∞–±–æ—Ç–∞–µ—Ç —Å Redis TimeSeries, Hash, String, Stream
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∑–∞–ø–∏—Å—å –≤ PostgreSQL
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏: –∞–≥—Ä–µ–≥–∞—Ü–∏—è, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã, —Å–Ω–∞–ø—à–æ—Ç—ã

---

## üß± –ì—Ä—É–ø–ø—ã —Ñ—É–Ω–∫—Ü–∏–π

### 1. üì• –ß—Ç–µ–Ω–∏–µ OHLCV

```python
async def load_ohlcv_from_redis(symbol, tf, count, redis)
```
–ü–æ–ª—É—á–∞–µ—Ç N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–≤–µ—á–µ–π –∏–∑ RedisTimeSeries –ø–æ –∫–ª—é—á—É `ohlcv:<symbol>:<tf>`

```python
async def load_ohlcv_from_pg(symbol, tf, count, pg_pool)
```
–†–µ–∑–µ—Ä–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ OHLCV –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `ohlcv2_<tf>`, –µ—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –ø—É—Å—Ç

---

### 2. üì§ –ó–∞–ø–∏—Å—å OHLCV

```python
async def save_ohlcv_to_redis(symbol, tf, candle, redis)
```
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≤–µ—á—É –≤ RedisTimeSeries (TS.ADD)

```python
async def save_ohlcv_to_pg(symbol, tf, candle, pg_pool)
```
–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç OHLCV –≤ PostgreSQL ‚Äî —Ç–∞–±–ª–∏—Ü—ã `ohlcv2_m1`, `ohlcv2_m5`, `ohlcv2_m15` –∏ —Ç.–¥.

---

### 3. üìà –†–∞–±–æ—Ç–∞ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏

```python
async def save_indicator(symbol, tf, name, value, redis, pg_pool)
```
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –≤ Redis (Hash –∏–ª–∏ String)
- –î—É–±–ª–∏—Ä—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `indicator_values_v2`

```python
async def get_indicator(symbol, tf, name, redis)
```
- –ü–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∏–∑ Redis –ø–æ –∫–ª—é—á—É

---

### 4. üîÅ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π

```python
async def publish_event(channel, payload, redis)
```
–û—Ç–ø—Ä–∞–≤–∫–∞ PubSub —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ohlcv_m1_ready`)

```python
async def publish_stream(stream, payload, redis)
```
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ Redis Stream (`XADD`), –Ω–∞–ø—Ä–∏–º–µ—Ä `ohlcv_m5_ready`

---

## üß© –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤

| –ú–æ–¥—É–ª—å               | –¶–µ–ª—å                                      |
|----------------------|--------------------------------------------|
| `feed_and_aggregate.py` | —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ M1, –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Redis         |
| `aggregator_worker.py`  | —á—Ç–µ–Ω–∏–µ M1, –∑–∞–ø–∏—Å—å M5                     |
| `indicators_main.py`    | —á—Ç–µ–Ω–∏–µ —Å–≤–µ—á–µ–π, –∑–∞–ø–∏—Å—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤        |
| `snapshot.py`           | —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∑–∞–ø–∏—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏—è               |

---

## üß† –†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ

| –§—É–Ω–∫—Ü–∏—è             | –î–∞/–ù–µ—Ç |
|---------------------|--------|
| –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö       | ‚úÖ     |
| –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö       | ‚úÖ     |
| –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ         | ‚ùå (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `infra.py`) |
| –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞       | ‚ùå     |

---

## üìå –ü—Ä–∏–º–µ—Ä —Å–∏–≥–Ω–∞—Ç—É—Ä

```python
async def save_ohlcv_to_redis(symbol: str, tf: str, candle: dict, redis) -> None
async def load_ohlcv_from_pg(symbol: str, tf: str, count: int, pg_pool) -> List[dict]
async def save_indicator(symbol: str, tf: str, name: str, value: float, redis, pg_pool) -> None
async def publish_stream(stream: str, payload: dict, redis) -> None
```

---

`core_io.py` ‚Äî —ç—Ç–æ —à–ª—é–∑ –º–µ–∂–¥—É –ª–æ–≥–∏–∫–æ–π –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π I/O –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–µ.