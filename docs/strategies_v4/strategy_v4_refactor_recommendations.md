# üîß –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–π v3 ‚Üí v4

---

## üß± 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### ‚úÖ –†–∞–∑–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞ –º–æ–¥—É–ª–∏

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞              | –ù–æ–≤—ã–π —Ñ–∞–π–ª –≤ `v4`                  |
|--------------------------|-------------------------------------|
| –°–ª—É—à–∞—Ç–µ–ª—å —Å–∏–≥–Ω–∞–ª–æ–≤       | `strategies_v4_main.py`            |
| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å                | `strategy_interface_v4.py`         |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ TP/SL          | `position_close_engine.py`         |
| –ú–æ–Ω–∏—Ç–æ—Ä —Ü–µ–Ω              | `price_monitor.py` (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)    |
| –ë–∞–∑–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏        | `strategies/strategy_X.py`         |

---

## üîÅ 2. –ü–æ—Ç–æ–∫–∏ –∏ —Å–æ–±—ã—Ç–∏—è

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `XREADGROUP` –¥–ª—è –≤—Å–µ—Ö Redis Streams.
- `strategy_tasks` ‚Üí –≥—Ä—É–ø–ø–∞ `strategy_worker_group`

---

## üß© 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏

- –£–¥–∞–ª–∏—Ç—å –∂—ë—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–π.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ PostgreSQL + –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç.

---

## üìä 4. –î–∞–Ω–Ω—ã–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

- –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å in-memory —Å–ª–æ–≤–∞—Ä–∏ (`open_positions`, `prices`) –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.
- –ò—Å–∫–ª—é—á–∏—Ç—å Redis `KEYS`, –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `mget()` –ø–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–º —Ç–∏–∫–µ—Ä–∞–º.

---

## üîÅ 5. –†–µ–≤–µ—Ä—Å

- `run_basic_checks(...)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `reverse_required=True`
- –ï—Å–ª–∏ —Ä–∞—Å—á—ë—Ç –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–æ—à—ë–ª ‚Üí `open_position(..., close_opposite=True)`
- `open_position()` –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é, –æ—Ç–º–µ–Ω—è–µ—Ç —Ü–µ–ª–∏, –ª–æ–≥–∏—Ä—É–µ—Ç `close_reason='reversed'`

---

## üéØ 6. –¶–µ–ª–∏ —Å `tp_trigger_type = signal`

- –í `signals_v4_main.py`: –ø—Ä–∏ —Å–∏–≥–Ω–∞–ª–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ TP —Å `tp_trigger_type='signal'`
- –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Üí —Ü–µ–ª—å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è, –ø–æ–∑–∏—Ü–∏—è —á–∞—Å—Ç–∏—á–Ω–æ/–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

---

## üßæ 7. –û–±—Ä–∞–±–æ—Ç–∫–∞ TP/SL

- –í `position_close_loop`:
```python
if type == "sl":
    ...
elif type == "tp":
    ...
```
- –û–±–µ –≤–µ—Ç–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —è–≤–Ω–æ –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

---

## üß† 8. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è:
  - –≤—Ö–æ–¥/–≤—ã—Ö–æ–¥
  - —Ä–µ–≤–µ—Ä—Å
  - SL/TP
- –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `system_logs` –∏ `signal_log_entries_v2`

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

| –¶–µ–ª—å                          | –î–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –≤ v4 |
|-------------------------------|------------------|
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–π    | ‚úÖ                |
| –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å SL/TP              | ‚úÖ                |
| –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≤–µ—Ä—Å–æ–≤           | ‚úÖ                |
| –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ü–µ–ª–µ–π –ø–æ —Å–∏–≥–Ω–∞–ª–∞–º   | ‚úÖ                |
| –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Redis     | ‚úÖ                |
| –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –∏–∑–æ–ª—è—Ü–∏—è      | ‚úÖ                |

---