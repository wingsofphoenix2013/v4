<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Детали торгов по стратегии</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background: linear-gradient(to bottom right, #e0f2ff, #fde2e4);
      }
    </style>
  </head>
  <body class="min-h-screen font-sans text-slate-800">
    <!-- Верхнее меню навигации -->
    <header class="w-full bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
        <h1 class="text-2xl font-semibold text-blue-900 tracking-wide">Торговый Движок v4</h1>
        <nav class="space-x-4 text-sm font-medium text-slate-700">
          <a href="/" class="hover:text-blue-600 transition-colors">Главная</a>
          <a href="/tickers" class="hover:text-blue-600 transition-colors">Тикеры</a>
          <a href="/indicators" class="hover:text-blue-600 transition-colors">Индикаторы</a>
          <a href="/signals" class="hover:text-blue-600 transition-colors">Сигналы</a>
          <a href="/strategies" class="hover:text-blue-600 transition-colors">Стратегии</a>
          <a href="/trades" class="hover:text-blue-600 transition-colors">Торги</a>
          <a href="/status" class="hover:text-blue-600 transition-colors">Статус</a>
        </nav>
      </div>
    </header>
<!-- Контейнер кнопок и таблицы -->
<main class="max-w-7xl mx-auto px-4 py-10">
<a href="/trades?filter={{ filter | default('today') }}{% if series %}&series={{ series }}{% endif %}"
   class="inline-block mb-6 px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-800 rounded-lg font-medium">Назад к торгам</a>
<!-- Карточка: Стратегия -->
<div class="w-full bg-white/80 rounded-xl shadow p-6 mb-4">
  <h2 class="text-lg font-semibold text-slate-800 mb-2">Стратегия</h2>
  <!-- Контент временно пуст -->
</div>

<!-- Карточка: Статистика -->
<div class="w-full bg-white/80 rounded-xl shadow p-6 mb-4">
  <h2 class="text-lg font-semibold text-slate-800 mb-2">Статистика</h2>
  <!-- Контент временно пуст -->
</div>
<!-- Карточка: Открытые позиции -->
<div class="w-full bg-white/80 rounded-xl shadow p-6 mb-4">
  <h2 class="text-lg font-semibold text-slate-800 mb-4">Открытые позиции</h2>

  <table class="w-full table-auto text-sm text-slate-800">
    <thead class="text-left bg-slate-100 text-slate-700 text-sm uppercase">
      <tr>
        <th class="px-4 py-3 text-center">№</th>
        <th class="px-4 py-3">Дата входа</th>
        <th class="px-4 py-3 text-center">Тикер</th>
        <th class="px-4 py-3 text-center">Напр.</th>
        <th class="px-4 py-3 text-center">Вход</th>
        <th class="px-4 py-3 text-center">TP</th>
        <th class="px-4 py-3 text-center">SL</th>
        <th class="px-4 py-3 text-center">Статус</th>
        <th class="px-4 py-3 text-center">Удерж.</th>
        <th class="px-4 py-3 text-right">Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for p in open_positions %}
      <tr class="border-b border-slate-100 hover:bg-slate-50">
        <td class="py-2 text-center">{{ loop.index }}</td>
        <td class="py-2">{{ p.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <td class="py-2 font-bold uppercase">{{ p.symbol }}</td>
        <td class="py-2 flex items-center space-x-1">
          {% if p.direction == "long" %}
            <span class="text-green-500 text-xs">▲</span>
          {% elif p.direction == "short" %}
            <span class="text-red-500 text-xs">▼</span>
          {% endif %}
          <span>{{ p.direction }}</span>
        </td>
        <td class="py-2 text-center">{{ p.entry_price if p.entry_price is not none else "—" }}</td>
        <td class="py-2 text-center">
          {% set tp = tp_sl_by_uid.get(p.position_uid, {}).get('tp') %}
          {{ tp.price if tp else "—" }}
        </td>
        <td class="py-2 text-center">
          {% set sl = tp_sl_by_uid.get(p.position_uid, {}).get('sl') %}
          {{ sl.price if sl else "—" }}
        </td>
        <td class="py-2 text-center">
          {{ p.close_reason if p.close_reason else "открыта" }}
        </td>
        <td class="py-2 text-center">
{% set duration = (now - p.created_at).total_seconds() | int %}
{% set hours = duration // 3600 %}
{% set minutes = (duration % 3600) // 60 %}
{{ hours }} ч {{ minutes }} мин
        </td>
        <td class="py-2 text-right space-x-2">
          <button class="px-3 py-1 text-sm bg-slate-200 hover:bg-slate-300 rounded-md">Детали</button>
          <button class="px-3 py-1 text-sm bg-red-500 text-white hover:bg-red-600 rounded-md">Закрыть</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<!-- Карточка: История торгов -->
<div class="w-full bg-white/80 rounded-xl shadow p-6">
  <h2 class="text-lg font-semibold text-slate-800 mb-4">История торгов</h2>

  <table class="w-full table-auto text-sm text-slate-800">
    <thead class="text-center bg-slate-100 text-slate-700 text-sm uppercase">
      <tr>
        <th class="px-4 py-3">№</th>
        <th class="px-4 py-3 text-left">Дата входа</th>
        <th class="px-4 py-3">Тикер</th>
        <th class="px-4 py-3">Напр.</th>
        <th class="px-4 py-3">Вход</th>
        <th class="px-4 py-3">Выход</th>
        <th class="px-4 py-3">Статус</th>
        <th class="px-4 py-3 text-left">Дата выхода</th>
        <th class="px-4 py-3">PnL</th>
        <th class="px-4 py-3 text-right">Детали</th>
      </tr>
    </thead>
    <tbody>
      {% for p in closed_positions %}
      <tr class="border-b border-slate-100 hover:bg-slate-50 text-center">
        <td class="py-2">{{ loop.index + ((current_page - 1) * 50) }}</td>
        <td class="py-2 text-left">{{ p.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <td class="py-2 font-bold uppercase">{{ p.symbol }}</td>
        <td class="py-2">
          {% if p.direction == "long" %}
            <span class="text-green-500 text-xs">▲</span>
          {% elif p.direction == "short" %}
            <span class="text-red-500 text-xs">▼</span>
          {% endif %}
          {{ p.direction }}
        </td>
        <td class="py-2">{{ p.entry_price if p.entry_price is not none else "—" }}</td>
        <td class="py-2">{{ p.exit_price if p.exit_price is not none else "—" }}</td>
        <td class="py-2">{{ p.close_reason if p.close_reason else "—" }}</td>
        <td class="py-2 text-left">
          {{ p.closed_at.strftime('%Y-%m-%d %H:%M:%S') if p.closed_at else "—" }}
        </td>
        <td class="py-2">{{ p.pnl if p.pnl is not none else "—" }}</td>
        <td class="py-2 text-right">
          <button class="px-3 py-1 text-sm bg-slate-200 hover:bg-slate-300 rounded-md">Детали</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Пагинация -->
  {% if total_pages > 1 %}
  <div class="mt-4 flex justify-center space-x-2">
    {% for i in range(1, total_pages + 1) %}
    <a href="?page={{ i }}{% if filter %}&filter={{ filter }}{% endif %}{% if series %}&series={{ series }}{% endif %}"
       class="px-3 py-1 rounded-md text-sm font-medium
              {{ 'bg-blue-600 text-white' if i == current_page else 'bg-slate-200 text-slate-800 hover:bg-slate-300' }}">
      {{ i }}
    </a>
    {% endfor %}
  </div>
  {% endif %}
</div>
</main>
	</body>
</html>