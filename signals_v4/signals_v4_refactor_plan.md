# üîß –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ `signals_v2_main.py` ‚Üí `signals_v4_main.py`

---

## üéØ –¶–µ–ª—å

–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
- –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—É–ª—ã;
- –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞;
- Redis Streams —Å Consumer Groups;
- –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ–±—â–∏–π –ø–∞–π–ø–ª–∞–π–Ω `feed_v4_main.py`.

---

## üîπ –≠–¢–ê–ü 1: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø

### ‚úÖ 1.1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Redis –∏ PostgreSQL
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `infra.py`:
  - `init_pg_pool()`
  - `init_redis_client()`

### ‚úÖ 1.2. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- [ ] `TICKERS`, `STRATEGIES`, `STRATEGY_SIGNALS`
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∞—Ç–æ–º–∞—Ä–Ω—ã–π swap (`.clear()`, `.update()`)

---

## üîπ –≠–¢–ê–ü 2: –ó–ê–ì–†–£–ó–ö–ê –°–ü–†–ê–í–û–ß–ù–ò–ö–û–í

- [ ] `load_tickers()`
- [ ] `load_strategies()`
- [ ] `load_strategy_signals()`
- [ ] –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: `asyncio.create_task(...)`

---

## üîπ –≠–¢–ê–ü 3: –ü–û–î–ü–ò–°–ö–ê –ù–ê REDIS STREAM

### ‚úÖ 3.1. `XREADGROUP`
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã `signal_processor` (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- [ ] –ß—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `XREADGROUP`
- [ ] –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `XACK`

---

## üîπ –≠–¢–ê–ü 4: –û–ë–†–ê–ë–û–¢–ö–ê –°–ò–ì–ù–ê–õ–ê

### ‚úÖ 4.1. `process_signal_entry(data)`
- [ ] –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π
- [ ] –ü–æ–∏—Å–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### ‚úÖ 4.2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- [ ] `asyncio.gather(...)` –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- [ ] –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:
  - –ª–æ–≥–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ
  - —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç `ignored`, `executed`, –∏ —Ç.–¥.

---

## üîπ –≠–¢–ê–ü 5: –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

### ‚úÖ 5.1. `log_system_event(...)`
- [ ] –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ `pg_pool`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç

---

## üîπ –≠–¢–ê–ü 6: –£–°–¢–û–ô–ß–ò–í–û–°–¢–¨

- [ ] –û–±–µ—Ä–Ω—É—Ç—å –≤–æ—Ä–∫–µ—Ä –≤ `run_safe_loop(...)`
- [ ] –õ–æ–≥ –∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (`XPENDING` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üß† –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å             | –û–ø–∏—Å–∞–Ω–∏–µ                                 |
|-------------------------|------------------------------------------|
| Redis dedup             | –ü—Ä–æ–≤–µ—Ä–∫–∞ `uid` –∏–ª–∏ Redis –∫–ª—é—á            |
| –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞   | –í Stream –∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–±—É–¥—É—â–µ–µ)       |
| –ú–µ—Ç—Ä–∏–∫–∏                 | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, count per strategy      |

---

## ‚úÖ –ò—Ç–æ–≥

| –¶–µ–ª—å                             | –î–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è |
|----------------------------------|-------------|
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å                 | ‚úÖ —á–µ—Ä–µ–∑ `XREADGROUP` |
| –°–∫–æ—Ä–æ—Å—Ç—å                         | ‚úÖ —á–µ—Ä–µ–∑ Pool + Gather |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å        | ‚úÖ —á–µ—Ä–µ–∑ Safe Loop     |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø–∞–π–ø–ª–∞–π–Ω            | ‚úÖ —á–µ—Ä–µ–∑ Redis/PG      |

---